{"id":"kicad-edit-mcp-5ee","title":"Push to GitHub","description":"Push to simon-77/kicad-edit-mcp. Update MCP README with new server entry.","status":"closed","priority":2,"issue_type":"task","owner":"simon@aster.wien","created_at":"2026-02-17T17:16:36.27667043+01:00","created_by":"Simon Aster","updated_at":"2026-02-17T18:30:19.450474721+01:00","closed_at":"2026-02-17T18:30:19.450474721+01:00","close_reason":"Closed","dependencies":[{"issue_id":"kicad-edit-mcp-5ee","depends_on_id":"kicad-edit-mcp-bbo","type":"blocks","created_at":"2026-02-17T17:16:36.279667816+01:00","created_by":"Simon Aster"}]}
{"id":"kicad-edit-mcp-7ji","title":"Fix: property visibility not preserved when editing components","description":"When update_component adds new properties, they're created as bare Property(key, value) with effects=None. KiCad interprets missing effects as visible. Fix: (1) new properties default hide=True for non-Reference/Value, (2) support explicit {value, visible} dict in properties param, (3) enrich get_component to return visibility info. See plan: .claude/plans/radiant-squishing-comet.md. Files: kicad_helpers.py, tests/fixtures/test_schematic.kicad_sch, tests/test_helpers.py","status":"closed","priority":2,"issue_type":"task","owner":"simon@aster.wien","created_at":"2026-02-18T09:05:01.429875115+01:00","created_by":"Simon Aster","updated_at":"2026-02-18T10:44:49.084097419+01:00","closed_at":"2026-02-18T10:44:49.084097419+01:00","close_reason":"Closed","comments":[{"id":26,"issue_id":"kicad-edit-mcp-7ji","author":"Simon Aster","text":"INVESTIGATION: Root cause at kicad_helpers.py:165 - Property(key=key, value=str(value)) creates bare property with effects=None. kiutils serializes this without (effects ...) block, which KiCad interprets as visible. In-place updates (line 158-162) are safe - only .value mutated, effects preserved. Secondary: get_component (line 85) flattens to {name: value}, discarding visibility. Fix plan in .claude/plans/radiant-squishing-comet.md","created_at":"2026-02-18T08:05:18Z"},{"id":27,"issue_id":"kicad-edit-mcp-7ji","author":"Simon Aster","text":"DISPATCH_PROMPT [python-backend-supervisor]:\n\nBEAD_ID: kicad-edit-mcp-7ji\n\n## Task: Fix property visibility not preserved when editing components\n\n### Bug\nWhen `update_component()` adds new properties, they're created as bare `Property(key=key, value=str(value))` with `effects=None` at `kicad_helpers.py:165`. kiutils serializes this without an `(effects ...)` block, which KiCad interprets as \"visible with default font.\" This makes all new properties visible instead of hidden.\n\nThe in-place update path (line 158-162) is safe - it only modifies `.value`, preserving effects.\n\n### Required Changes\n\n**File: `kicad_helpers.py`**\n\n1. **Add imports** (line 12): Add `Effects, Font` to the existing import:\n   ```python\n   from kiutils.items.common import Effects, Font, Property, TitleBlock\n   ```\n\n2. **Fix `update_component()` property loop** (lines 139-167):\n   - Support two value formats: plain `{\"Value\": \"100nF\"}` and rich `{\"Voltage\": {\"value\": \"3.3V\", \"visible\": false}}`\n   - Normalize at loop start: if value is a dict with \"value\" key, extract `raw_value` and `explicit_visible`; otherwise plain value with `explicit_visible=None`\n   - For existing properties: preserve visibility, but if `explicit_visible` is not None AND `existing.effects` exists, set `existing.effects.hide = not explicit_visible`\n   - For new properties: create with `Effects(font=Font(height=1.27, width=1.27), hide=...)` where hide defaults to `True` for non-Reference/Value properties (KiCad convention), overridden by `explicit_visible` if provided\n   - Copy position from first existing property as anchor point\n\n3. **Enrich `get_component()` return** (lines 84-87): Change from `{name: value}` to `{name: {\"value\": value, \"visible\": bool}}`:\n   ```python\n   props = {}\n   for p in sym.properties:\n       hidden = p.effects.hide if p.effects else False\n       props[p.key] = {\"value\": p.value, \"visible\": not hidden}\n   ```\n\n**File: `tests/fixtures/test_schematic.kicad_sch`**\n\n4. Add realistic effects blocks to match real KiCad files. For each symbol's Footprint and Datasheet properties, add:\n   ```\n  ","created_at":"2026-02-18T08:09:45Z"},{"id":28,"issue_id":"kicad-edit-mcp-7ji","author":"Simon Aster","text":"DISPATCH_PROMPT [python-backend-supervisor]:\n\nBEAD_ID: kicad-edit-mcp-7ji\n\nOne review finding to fix: when creating a new property (line 202 in kicad_helpers.py), copy the position from the first existing property on the component so the new property text appears near the component instead of at absolute (0,0).\n\nIn the worktree at `.worktrees/bd-kicad-edit-mcp-7ji/`, in `kicad_helpers.py`, right after creating `new_prop` at line 202 and before `target.properties.append(new_prop)`, add:\n\n```python\n# Anchor new property near the component (avoid default 0,0 origin)\nif target.properties:\n    new_prop.position = target.properties[0].position\n```\n\nThis copies the Position object from the first existing property (e.g., Reference) so the new property text is at least near the component on the schematic sheet.\n\nThen run `pytest tests/` to verify all tests still pass and commit.","created_at":"2026-02-18T08:32:13Z"},{"id":29,"issue_id":"kicad-edit-mcp-7ji","author":"Simon Aster","text":"DISPATCH_PROMPT [python-backend-supervisor]:\n\nBEAD_ID: kicad-edit-mcp-7ji\n\nSmall fix in worktree `.worktrees/bd-kicad-edit-mcp-7ji/kicad_helpers.py`:\n\nCurrently new properties copy position from the first existing property. Instead, use the **symbol's own position** (the component origin) via `target.position`.\n\nFind the line that does:\n```python\nif target.properties:\n    new_prop.position = target.properties[0].position\n```\n\nReplace with:\n```python\nnew_prop.position = target.position\n```\n\nThis is simpler and semantically correct — `target` is the `SchematicSymbol` and `target.position` is the component's placement coordinate on the schematic.\n\nRun `pytest tests/` to verify, then amend into the previous commit (since this is a refinement of the same change).","created_at":"2026-02-18T08:33:53Z"},{"id":30,"issue_id":"kicad-edit-mcp-7ji","author":"Simon Aster","text":"DISPATCH_PROMPT [python-backend-supervisor]:\n\nBEAD_ID: kicad-edit-mcp-7ji\n\nCode review found issues to fix in the worktree at `.worktrees/bd-kicad-edit-mcp-7ji/`. Address all in one commit.\n\n## Code Fixes\n\n### Fix 1: Validate malformed rich dict input (`kicad_helpers.py`)\n\nIn `update_component()`, the normalization block (around line 179) silently converts a dict without \"value\" key to its string repr. Add validation:\n\n```python\nif isinstance(value, dict) and \"value\" not in value:\n    raise ValueError(\n        f\"Property '{key}': dict value must have a 'value' key, \"\n        f\"e.g. {{'value': '3.3V', 'visible': false}}\"\n    )\n```\n\nPlace this BEFORE the existing `if isinstance(value, dict) and \"value\" in value:` check.\n\n### Fix 2: Deepcopy position to avoid reference sharing (`kicad_helpers.py`)\n\nThe line `new_prop.position = target.position` assigns a reference. If someone later mutates the property's position, it could affect the symbol. Change to:\n\n```python\nfrom copy import deepcopy\n# ... in the new property creation block:\nnew_prop.position = deepcopy(target.position)\n```\n\nAdd `from copy import deepcopy` at the top of the file with the other imports.\n\n### Fix 3: Add test for malformed dict input (`tests/test_helpers.py`)\n\nAdd a test that verifies `update_component` raises `ValueError` when given a dict without \"value\" key:\n\n```python\ndef test_update_component_rejects_malformed_dict(tmp_path):\n    sch = tmp_path / \"test.kicad_sch\"\n    shutil.copy(FIXTURE, sch)\n    with pytest.raises(ValueError, match=\"must have a 'value' key\"):\n        update_component(str(sch), \"R1\", {\"Voltage\": {\"foo\": \"bar\"}})\n```\n\n## Documentation Updates\n\n### Fix 4: `kicad_helpers.py` — `get_component` docstring\n\nUpdate the Returns section to describe the new format:\n\n```\nReturns:\n    Dict mapping property name to a dict with ``value`` and ``visible``\n    keys, e.g. ``{\"Reference\": {\"value\": \"C5\", \"visible\": True},\n    \"Footprint\": {\"value\": \"...\", \"visible\": False}}``.\n```\n\n### Fix 5: `kicad_helpers.py` — `update_component` docstring\n\nAdd to the docstring description of the prop","created_at":"2026-02-18T08:46:01Z"}]}
{"id":"kicad-edit-mcp-bbo","title":"Integration test","description":"Register in .mcp.json. Test: all tools visible default config, disable tools via restrictive config verify disappear, update_component on sample .kicad_sch, update_net_class on sample .kicad_pro","status":"closed","priority":2,"issue_type":"task","owner":"simon@aster.wien","created_at":"2026-02-17T17:16:32.489544176+01:00","created_by":"Simon Aster","updated_at":"2026-02-17T18:24:53.723497358+01:00","closed_at":"2026-02-17T18:24:53.723497358+01:00","close_reason":"Closed","dependencies":[{"issue_id":"kicad-edit-mcp-bbo","depends_on_id":"kicad-edit-mcp-w22","type":"blocks","created_at":"2026-02-17T17:16:32.492597257+01:00","created_by":"Simon Aster"}],"comments":[{"id":20,"issue_id":"kicad-edit-mcp-bbo","author":"Simon Aster","text":"INVESTIGATION: server.py smoke tested OK — import works, --help works, 7/7 tools enabled. No real .kicad_sch or .kicad_pro files on disk. Test needs to: 1) create minimal sample files using kiutils, 2) test tool enable/disable via config, 3) test actual modifications via kicad_helpers.","created_at":"2026-02-17T17:12:37Z"},{"id":21,"issue_id":"kicad-edit-mcp-bbo","author":"Simon Aster","text":"Completed: 34 tests passing — 25 helper tests (all 7 functions) + 9 server config tests. Fixtures: hand-crafted .kicad_sch with R1/C1/U1 + SPI1_SCK label, .kicad_pro with Default net class.","created_at":"2026-02-17T17:19:41Z"},{"id":22,"issue_id":"kicad-edit-mcp-bbo","author":"Simon Aster","text":"Completed: 34 integration tests covering all 7 kicad_helpers functions and server config loading, with hand-crafted KiCad fixture files.","created_at":"2026-02-17T17:19:56Z"},{"id":23,"issue_id":"kicad-edit-mcp-bbo","author":"Simon Aster","text":"Completed: 34 integration tests covering all 7 kicad_helpers functions and server config loading, with hand-crafted KiCad fixture files.","created_at":"2026-02-17T17:21:05Z"},{"id":24,"issue_id":"kicad-edit-mcp-bbo","author":"Simon Aster","text":"Completed: 34 integration tests covering all 7 kicad_helpers functions and server config loading, with hand-crafted KiCad fixture files.","created_at":"2026-02-17T17:22:25Z"},{"id":25,"issue_id":"kicad-edit-mcp-bbo","author":"Simon Aster","text":"DISPATCH_PROMPT [python-backend-supervisor]:\n\nBEAD_ID: kicad-edit-mcp-bbo\n\nIntegration tests for kicad-edit-mcp. Work in worktree:\n/home/simon/Nextcloud/Aster/Agents/MCP/dev/kicad-edit-mcp/.worktrees/bd-kicad-edit-mcp-jqq/\n\nVenv: ./venv/bin/python (fastmcp 2.14.5, kiutils 1.4.8, pyyaml 6.0.3)\n\n## Context\n\nserver.py and kicad_helpers.py are implemented. No real KiCad files exist on disk — you must create minimal test fixtures.\n\n## Tasks\n\n### 1. Create test fixtures in `tests/fixtures/`\n\n**Minimal .kicad_sch** — use kiutils to generate programmatically in a test helper, or create a minimal valid file by hand. Must contain:\n- At least 3 components: R1 (10k resistor), C1 (100nF cap), U1 (generic IC)\n- At least 1 net label (e.g., \"SPI1_SCK\")\n- A title block with some metadata\n\n**Minimal .kicad_pro** — valid JSON with:\n- `net_settings.classes` containing at least a \"Default\" class with track_width, clearance, via_diameter\n\n### 2. Create `tests/test_helpers.py` — pytest tests for kicad_helpers.py\n\nTest each of the 7 functions:\n- `list_components` — returns all 3, filter \"C\" returns only C1\n- `get_component` — \"R1\" returns correct props, \"MISSING\" raises ValueError\n- `update_component` — set value, remove property, set dnp flag, verify file changed\n- `update_schematic_info` — set title and revision, verify\n- `rename_net` — rename \"SPI1_SCK\" to \"SPI_CLK\", verify count and file\n- `list_net_classes` — returns Default class with rules\n- `update_net_class` — create new class \"USB\", add pattern, verify\n\nUse tmp_path fixture to copy test fixtures before modifying them.\n\n### 3. Create `tests/test_server.py` — test config loading and tool registration\n\n- Test that default config enables all 7 tools\n- Test that restrictive config (disable some tools) results in fewer registered tools\n- Test unknown tool name in config triggers warning\n\n### 4. Install pytest in venv and run tests\n\n```bash\n./venv/bin/pip install pytest\n./venv/bin/pytest tests/ -v\n```\n\nAll tests must pass.\n\n### 5. Commit\n\n```\ntest: add integration tests for helpers and server config\n```\nU","created_at":"2026-02-17T17:23:36Z"}]}
{"id":"kicad-edit-mcp-bm4","title":"Implement kicad_helpers.py","description":"All 7 functions, pure Python, no MCP dep. list_components, get_component, update_component, update_schematic_info, rename_net, list_net_classes, update_net_class. Signatures at kicad-dev/kicad-mcp-thoughts.md:70-108. Use kiutils.","status":"closed","priority":2,"issue_type":"task","owner":"simon@aster.wien","created_at":"2026-02-17T17:16:17.495107702+01:00","created_by":"Simon Aster","updated_at":"2026-02-17T17:30:51.500724966+01:00","closed_at":"2026-02-17T17:30:51.500724966+01:00","close_reason":"Closed","dependencies":[{"issue_id":"kicad-edit-mcp-bm4","depends_on_id":"kicad-edit-mcp-jqq","type":"blocks","created_at":"2026-02-17T17:16:17.498346023+01:00","created_by":"Simon Aster"}],"comments":[{"id":7,"issue_id":"kicad-edit-mcp-bm4","author":"Simon Aster","text":"INVESTIGATION: Tool signatures at kicad-dev/kicad-mcp-thoughts.md:70-108. 7 funcs using kiutils: list_components(path,filter), get_component(path,ref), update_component(path,ref,properties), update_schematic_info(path,title,rev,date,author,company), rename_net(path,old,new), list_net_classes(path), update_net_class(path,name,rules,add_pattern). Worktree at .worktrees/bd-kicad-edit-mcp-jqq/ has venv with kiutils 1.4.8 installed.","created_at":"2026-02-17T16:27:12Z"},{"id":9,"issue_id":"kicad-edit-mcp-bm4","author":"Simon Aster","text":"DISPATCH_PROMPT [python-backend-supervisor]:\n\nBEAD_ID: kicad-edit-mcp-bm4\n\nImplement kicad_helpers.py — all 7 pure Python functions using kiutils. Work in the worktree at:\n/home/simon/Nextcloud/Aster/Agents/MCP/dev/kicad-edit-mcp/.worktrees/bd-kicad-edit-mcp-jqq/\n\nUse the venv at that same worktree: ./venv/bin/python (kiutils 1.4.8, pyyaml 6.0.3 already installed).\n\nFile to edit: `kicad_helpers.py` (currently placeholder).\n\n## 7 Functions to Implement\n\n### Schematic functions (.kicad_sch via kiutils.schematic.Schematic)\n\n1. **list_components(schematic_path: str, filter: str = None) -\u003e list**\n   Returns: [{\"reference\": \"C5\", \"value\": \"100nF\", \"footprint\": \"...\"}, ...]\n   Filter: optional prefix, e.g. \"C\" for capacitors, \"R\" for resistors\n   Use: `Schematic.from_file()`, iterate `schematic.schematicSymbols`\n\n2. **get_component(schematic_path: str, reference: str) -\u003e dict**\n   Returns: all properties as dict {\"Reference\": \"C5\", \"Value\": \"100nF\", ...}\n   Use: find symbol by reference in schematicSymbols, extract all properties\n\n3. **update_component(schematic_path: str, reference: str, properties: dict) -\u003e str**\n   properties: {\"Value\": \"100nF\"} to set, {\"Voltage\": None} to remove, {\"dnp\": True} for DNP flag\n   Returns: success message describing changes\n   Use: find symbol, modify properties, schematic.to_file()\n\n4. **update_schematic_info(schematic_path: str, title=None, revision=None, date=None, author=None, company=None) -\u003e str**\n   Modify title block metadata\n   Returns: success message with updated fields\n   Use: schematic.titleBlock\n\n5. **rename_net(schematic_path: str, old_name: str, new_name: str) -\u003e str**\n   Find and replace net labels\n   Returns: success message with count of renamed labels\n   Use: iterate schematic looking for net labels matching old_name\n\n### Project functions (.kicad_pro)\n\n6. **list_net_classes(project_path: str) -\u003e list**\n   Returns: [{\"name\": \"Default\", \"track_width\": 0.2, \"clearance\": 0.15, \"via_diameter\": 0.6, \"patterns\": [...], ...}, ...]\n   Note: .kicad_pro is JSON. Net classes live under net_settings.classes or similar.\n  ","created_at":"2026-02-17T16:27:38Z"},{"id":12,"issue_id":"kicad-edit-mcp-bm4","author":"Simon Aster","text":"Completed: 7 functions implemented. Schematic functions use kiutils (Schematic.from_file/to_file, schematicSymbols, labels, globalLabels, hierarchicalLabels, titleBlock). Project functions use json.load/dump directly since kiutils has no .kicad_pro support. All error paths raise ValueError with clear messages.","created_at":"2026-02-17T16:30:27Z"}]}
{"id":"kicad-edit-mcp-jqq","title":"Project scaffolding","description":"pyproject.toml (fastmcp, kiutils, pyyaml), .gitignore (venv/, __pycache__/), create venv, install deps","status":"closed","priority":2,"issue_type":"task","owner":"simon@aster.wien","created_at":"2026-02-17T17:16:11.479761473+01:00","created_by":"Simon Aster","updated_at":"2026-02-17T17:26:54.896845285+01:00","closed_at":"2026-02-17T17:26:54.896845285+01:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"kicad-edit-mcp-jqq","author":"Simon Aster","text":"INVESTIGATION: Reference pattern from digikey-mcp. pyproject.toml uses PEP 621 [project] format with flat deps list. FastMCP pattern: mcp = FastMCP('name'), @mcp.tool() decorator, mcp.run() entry. For kicad-edit-mcp: deps are fastmcp, kiutils, pyyaml. Python \u003e=3.11. Venv at ./venv/.","created_at":"2026-02-17T16:18:11Z"},{"id":2,"issue_id":"kicad-edit-mcp-jqq","author":"Simon Aster","text":"Completed: pyproject.toml (PEP 621), .gitignore, server.py, kicad_helpers.py placeholders; venv created with fastmcp 2.14.5, kiutils 1.4.8, pyyaml 6.0.3","created_at":"2026-02-17T16:21:09Z"},{"id":3,"issue_id":"kicad-edit-mcp-jqq","author":"Simon Aster","text":"Completed: pyproject.toml (PEP 621), .gitignore, server.py and kicad_helpers.py placeholders; venv with fastmcp 2.14.5, kiutils 1.4.8, pyyaml 6.0.3","created_at":"2026-02-17T16:21:19Z"},{"id":4,"issue_id":"kicad-edit-mcp-jqq","author":"Simon Aster","text":"Completed: pyproject.toml, .gitignore, server.py, kicad_helpers.py scaffolded; venv with fastmcp/kiutils/pyyaml installed","created_at":"2026-02-17T16:21:24Z"},{"id":5,"issue_id":"kicad-edit-mcp-jqq","author":"Simon Aster","text":"Completed: pyproject.toml, .gitignore, server.py, kicad_helpers.py scaffolded; venv with fastmcp/kiutils/pyyaml installed","created_at":"2026-02-17T16:24:24Z"},{"id":6,"issue_id":"kicad-edit-mcp-jqq","author":"Simon Aster","text":"DISPATCH_PROMPT [python-backend-supervisor]:\n\nBEAD_ID: kicad-edit-mcp-jqq\n\nProject scaffolding for kicad-edit-mcp. Working dir: /home/simon/Nextcloud/Aster/Agents/MCP/dev/kicad-edit-mcp\n\nTasks:\n1. Create `pyproject.toml` using PEP 621 [project] format (like digikey-mcp pattern):\n   - name: kicad-edit-mcp\n   - version: 0.1.0\n   - description: \"KiCad schematic/project modification MCP server\"\n   - requires-python: \"\u003e=3.11\"\n   - dependencies: [\"fastmcp\", \"kiutils\", \"pyyaml\"]\n\n2. Create `.gitignore` with: venv/, __pycache__/, *.pyc, .env, *.egg-info/, dist/, build/, .claude-tools/\n\n3. Create venv and install deps:\n   ```\n   python3 -m venv venv\n   ./venv/bin/pip install fastmcp kiutils pyyaml\n   ```\n\n4. Create empty placeholder files so the structure is clear:\n   - `server.py` with just a comment: `# kicad-edit-mcp server — implementation in BD-002/BD-003`\n   - `kicad_helpers.py` with just a comment: `# kiutils helper functions — implementation in BD-002`\n\nDo NOT create config.yaml or README.md (those are BD-004).\n\nAfter completing, commit all files (not venv/) with message:\n```\nfeat: project scaffolding with pyproject.toml and venv\n```\nUse git author: simon-77 \u003csimon-77@users.noreply.github.com\u003e","created_at":"2026-02-17T16:25:57Z"}]}
{"id":"kicad-edit-mcp-w22","title":"Implement server.py","description":"FastMCP server. argparse --config, YAML config loading (missing key=enabled), warn unknown keys, conditional mcp.tool() registration, wire to kicad_helpers.py, log enabled/disabled to stderr. Pattern ref: digikey-mcp/digikey_mcp_server.py","status":"closed","priority":2,"issue_type":"task","owner":"simon@aster.wien","created_at":"2026-02-17T17:16:23.304548733+01:00","created_by":"Simon Aster","updated_at":"2026-02-17T18:12:00.700732182+01:00","closed_at":"2026-02-17T18:12:00.700732182+01:00","close_reason":"Closed","dependencies":[{"issue_id":"kicad-edit-mcp-w22","depends_on_id":"kicad-edit-mcp-bm4","type":"blocks","created_at":"2026-02-17T17:16:23.307724035+01:00","created_by":"Simon Aster"}],"comments":[{"id":13,"issue_id":"kicad-edit-mcp-w22","author":"Simon Aster","text":"INVESTIGATION: kicad_helpers.py:1-440 has all 7 functions implemented. config.yaml:1-12 has tool names matching function names exactly. server.py needs: argparse --config, yaml.safe_load config, conditional mcp.tool() registration for each of 7 tools, wiring to kicad_helpers funcs, stderr logging of enabled/disabled. FastMCP pattern: mcp = FastMCP('name'), @mcp.tool() or mcp.tool()(fn), mcp.run().","created_at":"2026-02-17T16:31:08Z"},{"id":14,"issue_id":"kicad-edit-mcp-w22","author":"Simon Aster","text":"Completed: implemented server.py — FastMCP server with argparse --config, YAML opt-out config, conditional tool registration for all 7 tools, stderr startup log, ValueError-\u003eerror-string wrapping","created_at":"2026-02-17T16:32:38Z"},{"id":15,"issue_id":"kicad-edit-mcp-w22","author":"Simon Aster","text":"Completed: implemented server.py — FastMCP server with argparse --config, YAML opt-out config, conditional tool registration for all 7 tools, stderr startup log, ValueError-\u003eerror-string wrapping","created_at":"2026-02-17T16:32:47Z"},{"id":16,"issue_id":"kicad-edit-mcp-w22","author":"Simon Aster","text":"Completed: implemented server.py — FastMCP server with argparse --config, YAML opt-out config, conditional tool registration for all 7 tools, stderr startup log, ValueError-\u003eerror-string wrapping","created_at":"2026-02-17T16:46:07Z"},{"id":17,"issue_id":"kicad-edit-mcp-w22","author":"Simon Aster","text":"Completed: implemented server.py with FastMCP, YAML config, conditional tool registration for all 7 tools","created_at":"2026-02-17T16:47:15Z"},{"id":18,"issue_id":"kicad-edit-mcp-w22","author":"Simon Aster","text":"Completed: server.py implements FastMCP with YAML config and 7 conditional tools","created_at":"2026-02-17T16:48:43Z"},{"id":19,"issue_id":"kicad-edit-mcp-w22","author":"Simon Aster","text":"DISPATCH_PROMPT [python-backend-supervisor]:\n\nBEAD_ID: kicad-edit-mcp-w22\n\nImplement server.py — the FastMCP server for kicad-edit-mcp. Work in worktree:\n/home/simon/Nextcloud/Aster/Agents/MCP/dev/kicad-edit-mcp/.worktrees/bd-kicad-edit-mcp-jqq/\n\nThe venv at ./venv/ has fastmcp 2.14.5, kiutils 1.4.8, pyyaml 6.0.3.\n\n## What Already Exists\n\n- `kicad_helpers.py` — 7 pure Python functions (already implemented, 440 lines)\n- `config.yaml` — default config with all 7 tools enabled\n\n## server.py Requirements\n\n1. **Imports**: fastmcp.FastMCP, argparse, yaml, sys, logging, pathlib, all 7 functions from kicad_helpers\n\n2. **Config loading**:\n   - `argparse` with `--config` flag (optional path)\n   - Default: look for `config.yaml` in same directory as `server.py`\n   - No config file found = all tools enabled (not an error)\n   - `yaml.safe_load()` the config\n   - Warn to stderr if config contains unknown tool names (typo protection)\n   - Missing key in config = tool is enabled (opt-out model)\n\n3. **FastMCP initialization**: `mcp = FastMCP(\"kicad-edit-mcp\")`\n\n4. **Conditional tool registration** — for each of 7 tools, only register if enabled in config:\n   ```python\n   if tool_enabled(\"list_components\"):\n       @mcp.tool()\n       def list_components(schematic_path: str, filter: str = None) -\u003e list:\n           \"\"\"List all components with references, values, footprints. Optional prefix filter (e.g. 'C' for capacitors).\"\"\"\n           return kicad_helpers.list_components(schematic_path, filter)\n   ```\n   \n   The 7 tool names match exactly between config.yaml and kicad_helpers.py:\n   - list_components, get_component, update_component, update_schematic_info, rename_net, list_net_classes, update_net_class\n\n5. **Tool docstrings**: Each registered tool needs a clear, concise docstring (this is what the LLM sees). Keep them short but informative.\n\n6. **Stderr logging on startup**: Log which tools are enabled and disabled:\n   ```\n   kicad-edit-mcp: 5/7 tools enabled\n   kicad-edit-mcp: enabled: list_components, get_component, update_component, list_net_classes, update_net_clas","created_at":"2026-02-17T17:11:47Z"}]}
{"id":"kicad-edit-mcp-wn7","title":"config.yaml + README.md","description":"Default config.yaml with all 7 tools listed + comments. README: purpose, config format, registration examples, tool descriptions.","status":"closed","priority":2,"issue_type":"task","owner":"simon@aster.wien","created_at":"2026-02-17T17:16:28.006892723+01:00","created_by":"Simon Aster","updated_at":"2026-02-17T17:30:51.574996205+01:00","closed_at":"2026-02-17T17:30:51.574996205+01:00","close_reason":"Closed","dependencies":[{"issue_id":"kicad-edit-mcp-wn7","depends_on_id":"kicad-edit-mcp-jqq","type":"blocks","created_at":"2026-02-17T17:16:28.010476858+01:00","created_by":"Simon Aster"}],"comments":[{"id":8,"issue_id":"kicad-edit-mcp-wn7","author":"Simon Aster","text":"INVESTIGATION: config.yaml should list all 7 tools (list_components, get_component, update_component, update_schematic_info, rename_net, list_net_classes, update_net_class) with comments. All enabled by default (opt-out model). README should cover: purpose, YAML config format, Claude Code registration examples, tool descriptions. Pattern ref: kicad-dev/kicad-mcp-thoughts.md for tool descriptions.","created_at":"2026-02-17T16:27:15Z"},{"id":10,"issue_id":"kicad-edit-mcp-wn7","author":"Simon Aster","text":"DISPATCH_PROMPT [python-backend-supervisor]:\n\nBEAD_ID: kicad-edit-mcp-wn7\n\nCreate config.yaml and README.md for kicad-edit-mcp. Work in the worktree at:\n/home/simon/Nextcloud/Aster/Agents/MCP/dev/kicad-edit-mcp/.worktrees/bd-kicad-edit-mcp-jqq/\n\n## config.yaml\n\nDefault config with all tools enabled (opt-out model). Include comments explaining each tool:\n\n```yaml\n# kicad-edit-mcp tool configuration\n# All tools enabled by default. Set to false to disable.\n# Disabled tools are not registered with MCP (LLM cannot see them).\n\ntools:\n  list_components: true      # Read: list components with refs, values, footprints\n  get_component: true        # Read: get all properties of a component by reference\n  update_component: true     # Write: set/remove component properties\n  update_schematic_info: true # Write: modify title block metadata (title, rev, date, author, company)\n  rename_net: true           # Write: rename net labels in schematic\n  list_net_classes: true     # Read: list net class rules and pattern assignments\n  update_net_class: true     # Write: create/modify net class rules and patterns\n```\n\n## README.md\n\nInclude:\n1. **Purpose**: Minimal MCP server for controlled KiCad schematic/project modifications using kiutils. Companion to kicad-analysis (Seeed-Studio, read-only). Property modifications only — no topology changes.\n2. **Tools**: Table of all 7 tools with brief descriptions\n3. **Configuration**: YAML format, --config flag, per-project override example (.kicad-modify.yaml)\n4. **Installation**: pip install deps, Claude Code registration via `claude mcp add`\n5. **Registration examples**: Basic and per-project with --config flag\n6. **Philosophy**: Only modify properties of existing elements. Never change circuit topology or physical layout.\n\nKeep README concise — this is a utility, not a framework.\n\nAfter completing, commit with:\n```\ndocs: add config.yaml and README.md\n```\nUse git author: simon-77 \u003csimon-77@users.noreply.github.com\u003e","created_at":"2026-02-17T16:27:49Z"},{"id":11,"issue_id":"kicad-edit-mcp-wn7","author":"Simon Aster","text":"Completed: config.yaml and README.md written and pushed.","created_at":"2026-02-17T16:28:33Z"}]}
